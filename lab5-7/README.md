# Лабораторные работы №5-7

## Цель работы

Целью является приобретение практических навыков в:

- **Управлении серверами сообщений** (№5)  
- **Применении отложенных вычислений** (№6)  
- **Интеграции программных систем друг с другом** (№7)  

---

## Задание

Реализовать распределенную систему по асинхронной обработке запросов.  
В данной распределенной системе должно существовать 2 вида узлов: **«управляющий»** и **«вычислительный»**. 

Необходимо объединить данные узлы в соответствии с топологией, определенной вариантом. Связь между узлами осуществляется при помощи технологии очередей сообщений.  

Система должна предусмотреть проверку доступности узлов. Если любой вычислительный узел убивается (`kill -9`), система должна сохранять работоспособность:  
- Дочерние узлы убитого узла могут стать недоступными.  
- Родительские узлы должны сохранить свою работоспособность.  

---

## Управляющий узел

### Функции:
- Ввод команд от пользователя.  
- Отправка команд на вычислительные узлы.  

---

### **Основные поддерживаемые команды:**

#### 1. **Создание нового вычислительного узла**  

**Формат команды:**  
```
create id [parent]
```

- `id` — целочисленный идентификатор нового вычислительного узла  
- `parent` — целочисленный идентификатор родительского узла. Игнорируется, если топология не требует его указания.  

**Формат вывода:**  
- `Ok: pid` — идентификатор процесса для созданного вычислительного узла.  
- `Error: Already exists` — узел с таким `id` уже существует.  
- `Error: Parent not found` — родительский узел не найден.  
- `Error: Parent is unavailable` — родительский узел существует, но с ним невозможно связаться.  
- `Error: [Custom error]` — любая другая ошибка.  

**Пример:**  
```
> create 10 5  
Ok: 3128
```

> **Примечание:**  
> `id` и `pid` — разные идентификаторы. Создание нового управляющего узла происходит запуском программы.

---

#### 2. **Исполнение команды на вычислительном узле**  

**Формат команды:**  
```
exec id [params]
```

- `id` — идентификатор узла, на который отправляется команда.  

**Формат вывода:**  
- `Ok:id: [result]` — результат выполнения команды.  
- `Error:id: Not found` — узел не найден.  
- `Error:id: Node is unavailable` — узел недоступен.  
- `Error:id: [Custom error]` — любая другая ошибка.  

**Пример:**  
```
> exec 10 3 1 2 3  
Ok:10: 6
```

> **Примечание:**  
> Выполнение команд должно быть асинхронным. Пока команда выполняется на одном узле, можно отправить другую команду на другой узел.

---

## Топология 4  

![asd](img/topology.png)

- Все вычислительные узлы хранятся в идеально сбалансированном бинарном дереве.  
- `[parent]` — необязательный параметр.  
- Каждый следующий узел добавляется в наименьшее поддерево.

---

## Типы команд  

### **Тип команды 1:**  

**Формат команды:**  
```
exec id n k1 … kn
```

- `id` — идентификатор узла.  
- `n` — количество чисел (от 1 до 108).  
- `k1 … kn` — складываемые числа.  

**Пример:**  
```
> exec 10 3 1 2 3  
Ok:10: 6
```

---

## Проверка доступности узлов  

### **Тип проверки доступности узлов 2:**  

**Формат команды:**  
```
ping id
```

**Описание:**  
Команда проверяет доступность узла с указанным `id`.  

**Формат вывода:**  
- `Error: Not found` — узел отсутствует.  
- `Ok: 1` — узел доступен.  
- `Ok: 0` — узел недоступен.  

**Примеры:**  
```
> ping 10  
Ok: 1  

> ping 17  
Ok: 0
```
